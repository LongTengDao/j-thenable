/*!
 * 模块名称：j-thenable
 * 模块功能：模仿 Promise API 的同步防爆栈工具。从属于“简计划”。
   　　　　　Sync stack anti-overflow util which's API is like Promise. Belong to "Plan J".
 * 模块版本：1.0.2
 * 许可条款：LGPL-3.0
 * 所属作者：龙腾道 <LongTengDao@LongTengDao.com> (www.LongTengDao.com)
 * 问题反馈：https://GitHub.com/LongTengDao/j-thenable/issues
 * 项目主页：https://GitHub.com/LongTengDao/j-thenable/
 */
(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Thenable=e()})(this,function(){"use strict";var o=Object.freeze,f=void 0,a=Object.create||function(){var r;if(document.domain)try{e=new ActiveXObject("htmlfile")}catch(a){}if(e)e.write("<script><\/script>"),e.close(),r=e.parentWindow.Object.prototype;else{(e=document.createElement("iframe")).style.display="none";var t=document.body||document.documentElement;t.appendChild(e),e.src="javascript:",r=e.contentWindow.Object.prototype,t.removeChild(e)}var e=null;delete r.constructor,delete r.hasOwnProperty,delete r.isPrototypeOf,delete r.propertyIsEnumerable,delete r.toLocaleString,delete r.toString,delete r.valueOf;var u=function(){};u.prototype=r;var o=function(){};function n(t,e){if(e!==f)throw TypeError("CAN NOT defineProperties in ES 3 Object.create polyfill");if(null===t)return new u;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object prototype may only be an Object or null: "+t);o.prototype=t;var n=new o;return o.prototype=r,n}return function(t,e){return n(t,e)}}(),l=Object.assign,s=Object.prototype.hasOwnProperty,i="undefined"!=typeof Symbol?Symbol.toStringTag:undefined,c=Object.defineProperty,n=function n(t,e){return function(t,e){if(e||(e=t,t=a(null)),l)l(t,e);else{for(var n in e)s.call(e,n)&&(t[n]=e[n]);if(!{toString:null}.propertyIsEnumerable("toString"))for(var r=["constructor","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","valueOf","toLocaleString","toString"];n=r.pop();)s.call(e,n)&&(t[n]=e[n])}if(t["default"]=t,o){if(i){var u=a(null);u.value="Module",c(t,i,u)}o(t)}return t}(t,e)},_=0,v=1,p=2,d=function(){};function y(t){return t instanceof d}function h(t){return null!=t&&"function"==typeof t.then}function b(e,t){var n;t.then(function(t){n||(n=!0,m(e,t,v))},function(t){n||(n=!0,m(e,t,p))})}var j=null;function m(t,e,n){if(j)j={nextStack:j,thenable:t,value:e,status:n};else for(;;){t:{if(n===v){t._onrejected&&(t._onrejected=f);var r=t._onfulfilled;if(r){t._onfulfilled=f;try{if(y(e=r(e))){if((o=e._status)===_){e._on.push(t);break t}e=e._value,n=o}else if(h(e)){b(t,e);break t}}catch(s){if(t._status!==_)break t;e=s,n=p}}}else{t._onfulfilled&&(t._onfulfilled=f);var u=t._onrejected;if(u){t._onrejected=f;try{if(y(e=u(e))){var o;if((o=e._status)===_){e._on.push(t);break t}e=e._value,n=o}else{if(h(e)){b(t,e);break t}n=v}}catch(s){if(t._status!==_)break t;e=s}}}t._value=e,t._status=n;var a=t._on;if(a){t._on=null;for(var l=a.length;l;)j={nextStack:j,thenable:a[--l],value:e,status:n}}}if(!j)break;t=j.thenable,e=j.value,n=j.status,j=j.nextStack}}var t=function(t){if("function"!=typeof t)throw TypeError("Thenable executor is not a function");var n,r,u,o,a=this;try{if(t(function(t){if(!r)if(r=!0,n)try{y(t)?(o=t._status)===_?t._on.push(a):m(a,t._value,o):h(t)?b(a,t):m(a,t,v)}catch(e){a._status===_&&m(a,e,p)}else u=t,o=v},function(t){r||(r=!0,n?m(a,t,p):(u=t,o=p))}),!r)return n=!0,void(a._on=[])}catch(e){if(!r)return r=!0,a._value=e,void(a._status=p)}try{o===v&&y(u)?(o=u._status)===_?(a._on=[],u._on.push(a)):(a._value=u._value,a._status=o):o===v&&h(u)?(a._on=[],b(a,u)):(a._value=u,a._status=o)}catch(e){a._status===_&&m(a,e,p)}};function w(t,e){if(y(e)){var n=e._status;n===_?(t._on=[],e._on.push(t)):(t._value=e._value,t._status=n)}else h(e)?(t._on=[],b(t,e)):(t._value=e,t._status=v)}return d.prototype=t.prototype={_status:_,_value:f,_on:null,_onfulfilled:f,_onrejected:f,then:function(t,e){var n=this,r=new d;switch(n._status){case _:return r._on=[],r._onfulfilled=t,r._onrejected=e,n._on.push(r),r;case v:if("function"==typeof t)try{w(r,t(n._value))}catch(u){r._status===_&&(r._value=u,r._status=p)}else r._value=n._value,r._status=v;return r;case p:if("function"==typeof e)try{w(r,e(n._value))}catch(u){r._status===_&&(r._value=u,r._status=p)}else r._value=n._value,r._status=p;return r}throw TypeError("Method Thenable.prototype.then called on incompatible receiver")}},n(t,{version:"1.0.2",Thenable:t,resolve:function r(t){var e=new d;try{w(e,t)}catch(n){e._status===_&&(e._value=n,e._status=p)}return e},reject:function u(t){var e=new d;return e._status=p,e._value=t,e},all:function O(t){var r=new d;r._on=[];var u=[],o=0;function e(t){r._status===_&&m(r,t,p)}try{for(var n=t.length,a=0;a<n;++a){var l=t[a];if(y(l)){var s=l._status;if(s===_)++o,l._on.push({_status:0,_value:u[a]=f,_on:null,_onfulfilled:function(e){return function(t){r._status===_&&(u[e]=t,1<o?--o:m(r,u,v))}}(a),_onrejected:e});else{if(s===p){r._value=l._value,r._status=p;break}u[a]=l._value}}else h(l)?(++o,u[a]=f,l.then(function(e){var n;return function(t){n||(n=!0,r._status===_&&(u[e]=t,1<o?--o:m(r,u,v)))}}(a),e)):u[a]=l}}catch(i){r._status===_&&m(r,i,p)}return r},race:function k(t){var e=new d;function n(t){e._status===_&&m(e,t,v)}function r(t){e._status===_&&m(e,t,p)}e._on=[];var u={_status:0,_value:f,_on:null,_onfulfilled:n,_onrejected:r};try{for(var o=t.length,a=0;a<o;++a){var l=t[a];if(y(l)){var s=l._status;if(s!==_){e._value=l._value,e._status=s;break}l._on.push(u)}else{if(!h(l)){e._value=l,e._status=v;break}if(l.then(n,r),e._status!==_)break}}}catch(i){e._status===_&&m(e,i,p)}return e}})});
//# sourceMappingURL=j-thenable.min.js.map