/*!
 * 模块名称：j-thenable
 * 模块功能：模仿 Promise API 的同步防爆栈工具。从属于“简计划”。
   　　　　　Sync stack anti-overflow util which's API is like Promise. Belong to "Plan J".
 * 模块版本：4.4.0
 * 许可条款：LGPL-3.0
 * 所属作者：龙腾道 <LongTengDao@LongTengDao.com> (www.LongTengDao.com)
 * 问题反馈：https://GitHub.com/LongTengDao/j-thenable/issues
 * 项目主页：https://GitHub.com/LongTengDao/j-thenable/
 */
(function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).Thenable=n()})(this,function(){"use strict";var c,s,d,a,l,i,p,h,v,y,b,w,k,f,_,m,j,O,g,t,u=Object.freeze,S=Object.seal,r=Object.getPrototypeOf,n=Object.preventExtensions,E=void 0,T=0,M=1,P=2,W=function W(){c(this)};if("function"==typeof WeakMap){var o=new WeakMap,x=new WeakMap,A=new WeakMap,C=new WeakMap,I=new WeakMap,L=new WeakMap;c=n&&function(){var e=n({});return x.set(e,e),x.has(e)}()?function c(e){o.set(n(e),T)}:function c(e){o.set(e,T)},s=function s(e){return o.has(e)},d=function d(e){A["delete"](e)},i=function i(e){L["delete"](e)},p=l=function l(e){C["delete"](e)},h=a=function a(e){I["delete"](e)},v=function v(e){return o.get(e)},y=function y(e){return x.get(e)},b=function b(e){return A.get(e)},w=function w(e){return C.get(e)},k=function k(e){return I.get(e)},f=function f(e){return L.get(e)},_=function _(e,n){o.set(e,n)},m=function m(e,n){x.set(e,n)},j=function j(e,n){A.set(e,n)},O=function O(e,n){C.set(e,n)},g=function g(e,n){I.set(e,n)},t=function t(e,n){L.set(e,n)}}else c=function c(){},s=r?function(e){var n=W.prototype;return(s=function(e){return null!=e&&r(e)===n})(e)}:function s(e){return e instanceof W},d=function d(e){e._dependents=E},l=function l(e){e._onfulfilled=E},a=function a(e){e._onrejected=E},i=function i(e){e._onthen=E},p=function p(e){e._onfulfilled&&(e._onfulfilled=E)},h=function h(e){e._onrejected&&(e._onrejected=E)},v=function v(e){return e._status},y=function y(e){return e._value},b=function b(e){return e._dependents},w=function w(e){return e._onfulfilled},k=function k(e){return e._onrejected},f=function f(e){return e._onthen},_=function _(e,n){e._status=n},m=function m(e,n){e._value=n},j=function j(e,n){e._dependents=n},O=function O(e,n){e._onfulfilled=n},g=function g(e,n){e._onrejected=n},t=function t(e,n){e._onthen=n};var N="function"==typeof Promise?function(){if(r){var n=Promise.prototype;return function(e){return null!=e&&r(e)===n}}var t=Promise;return function(e){return e instanceof t}}():function N(){return!1},z=null,X=!1;function q(e){var n=f(e);if(n)if(i(e),X)z={nextStack:z,thenable:e,onthen:n};else{for(X=!0;;){try{var t=n();if(s(t))if(n=f(t))i(t),b(t).push(e),z={nextStack:z,thenable:t,onthen:n};else{var r=v(t);r===T?b(t).push(e):F(e,y(t),r)}else N(t)?G(e,t):F(e,t,M)}catch(o){F(e,o,P)}if(!z)break;e=z.thenable,n=z.onthen,z=z.nextStack}X=!1}}var B=null,D=!1;function F(e,n,t){if(D)B={nextStack:B,thenable:e,value:n,status:t};else{D=!0;for(var r;;){e:{if(t===M){h(e);var o=w(e);if(o){l(e);try{if(n=o(n),s(n)){if(q(n),(r=v(n))===T){b(n).push(e);break e}n=y(n),t=r}else if(N(n)){G(e,n);break e}}catch(c){if(v(e)!==T)break e;n=c,t=P}}}else{p(e);var i=k(e);if(i){a(e);try{if(n=i(n),s(n)){if(q(n),(r=v(n))===T){b(n).push(e);break e}n=y(n),t=r}else{if(N(n)){G(e,n);break e}t=M}}catch(c){if(v(e)!==T)break e;n=c}}}m(e,n),_(e,t);var f=b(e);if(f){d(e);for(var u=f.length;u;)B={nextStack:B,thenable:f[--u],value:n,status:t}}}if(!B)break;e=B.thenable,n=B.value,t=B.status,B=B.nextStack}D=!1}}function G(n,e){var t;e.then(function(e){t||(t=!0,F(n,e,M))},function(e){t||(t=!0,F(n,e,P))})}var e=function(e){if("function"!=typeof e)throw TypeError("new Thenable(executor is not a function)");var t,r,o,i,f=this;c(f);try{if(e(function(e){if(!r)if(r=!0,t)try{s(e)?(q(e),(i=v(e))===T?b(e).push(f):F(f,y(e),i)):N(e)?G(f,e):F(f,e,M)}catch(n){v(f)===T&&F(f,n,P)}else o=e,i=M},function(e){r||(r=!0,t?F(f,e,P):(o=e,i=P))}),!r)return t=!0,void j(f,[])}catch(n){if(!r)return r=!0,m(f,n),void _(f,P)}try{!function u(e,n,t){if(n===M){if(s(t))return q(t),void((n=v(t))===T?(j(e,[]),b(t).push(e)):(m(e,y(t)),_(e,n)));if(N(t))return j(e,[]),void G(e,t)}m(e,t),_(e,n)}(f,i,o)}catch(n){v(f)===T&&(m(f,n),_(f,P),d(f))}};var H=function(e){if(s(e))switch(q(e),v(e)){case M:return y(e);case P:throw y(e)}return e},J="function"==typeof WeakMap?{then:K}:{_status:T,_value:E,_dependents:E,_onfulfilled:E,_onrejected:E,_onthen:E,then:K};function K(e,n){var t=this;if(s(t)){q(t);var r=new W;switch(v(t)){case T:return j(r,[]),"function"==typeof e&&O(r,e),"function"==typeof n&&g(r,n),b(t).push(r),r;case M:return"function"==typeof e?Q(t,e,r):(m(r,y(t)),_(r,M)),r;case P:return"function"==typeof n?Q(t,n,r):(m(r,y(t)),_(r,P)),r}}throw TypeError("Method Thenable.prototype.then called on incompatible receiver")}function Q(e,n,t){try{!function r(e,n){if(s(n)){q(n);var t=v(n);t===T?(j(e,[]),b(n).push(e)):(m(e,y(n)),_(e,t))}else N(n)?(j(e,[]),G(e,n)):(m(e,n),_(e,M))}(t,n(y(e)))}catch(o){v(t)===T&&(m(t,o),_(t,P))}}var R=Object.create||function(){var r;if(document.domain)try{n=new ActiveXObject("htmlfile")}catch(f){}if(n)n.write("<script><\/script>"),n.close(),r=n.parentWindow.Object.prototype;else{(n=document.createElement("iframe")).setAttribute("style","display:none !important;_display:none;");var e=document.body||document.documentElement;e.appendChild(n),n.src="javascript:",r=n.contentWindow.Object.prototype,e.removeChild(n)}var n=null;delete r.constructor,delete r.hasOwnProperty,delete r.isPrototypeOf,delete r.propertyIsEnumerable,delete r.toLocaleString,delete r.toString,delete r.valueOf;var o=function(){};o.prototype=r;var i=function(){};function t(e,n){if(n!==E)throw TypeError("CAN NOT defineProperties in ES 3 Object.create polyfill");if(null===e)return new o;if("object"!=typeof e&&"function"!=typeof e)throw TypeError("Object prototype may only be an Object or null: "+e);i.prototype=e;var t=new i;return i.prototype=r,t}return function(e,n){return t(e,n)}}(),U=Object.assign,V=Object.prototype.hasOwnProperty,Y="undefined"!=typeof Symbol?Symbol.toStringTag:undefined,Z=Object.defineProperty,$=function $(e,n){return function(e,n){if(n||(n=e,e=R(null)),U)U(e,n);else{for(var t in n)V.call(n,t)&&(e[t]=n[t]);if(!{toString:null}.propertyIsEnumerable("toString"))for(var r=["constructor","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","valueOf","toLocaleString","toString"];t=r.pop();)V.call(n,t)&&(e[t]=n[t])}if(e["default"]=e,S){if("function"==typeof e&&e.prototype&&S(e.prototype),Y){var o=R(null);o.value="Module",Z(e,Y,o)}u(e)}return e}(e,n)};return e.prototype=W.prototype="function"==typeof WeakMap?u(J):S?S(J):J,$(e,{version:"4.4.0",Thenable:e,resolve:function ee(e){if(s(e))return e;var n=new W;return N(e)?(j(n,[]),function r(e,n){try{G(e,n)}catch(t){v(e)===T&&(m(e,t),_(e,P))}}(n,e)):(m(n,e),_(n,M)),n},reject:function ne(e){var n=new W;return _(n,P),m(n,e),n},all:function te(e){var n=new W;try{!function p(e,r){function o(e){v(r)===T&&F(r,e,P)}j(r,[]);for(var i,f=[],u=0,n=e.length,t=0;t<n;++t){var c=e[t];if(s(c)){q(c);var a=v(c);if(a===T){++u,f[t]=E;var l=new W;!function(n){O(l,function(e){v(r)===T&&(f[n]=e,!--u&&i&&F(r,f,M))})}(t),g(l,o),b(c).push(l)}else{if(a===P){m(r,y(c)),_(r,P);break}f[t]=y(c)}}else N(c)?(++u,f[t]=E,function(n){var t;c.then(function(e){t||(t=!0,v(r)===T&&(f[n]=e,!--u&&i&&F(r,f,M)))},o)}(t)):f[t]=c}i=!0,u||v(r)!==T||(m(r,f),_(r,M),d(r))}(e,n)}catch(t){v(n)===T&&(m(n,t),_(n,P),d(n))}return n},race:function re(e){var n=new W;try{!function a(e,n){function t(e){v(n)===T&&F(n,e,M)}function r(e){v(n)===T&&F(n,e,P)}j(n,[]);var o=new W;O(o,t),g(o,r);for(var i=e.length,f=0;f<i;++f){var u=e[f];if(s(u)){q(u);var c=v(u);if(c!==T){m(n,y(u)),_(n,c);break}b(u).push(o)}else{if(!N(u)){m(n,u),_(n,M);break}if(u.then(t,r),v(n)!==T)break}}}(e,n)}catch(t){v(n)===T&&(m(n,t),_(n,P),d(n))}return n},pend:function oe(e){if("function"!=typeof e)throw TypeError("Thenable.pend(onthen is not a function)");var n=new W;return j(n,[]),t(n,e),n},await:H})});
//# sourceMappingURL=j-thenable.min.js.map