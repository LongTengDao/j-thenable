/*!
 * 模块名称：j-thenable
 * 模块功能：模仿 Promise API 的同步防爆栈工具。从属于“简计划”。
   　　　　　Sync stack anti-overflow util which's API is like Promise. Belong to "Plan J".
 * 模块版本：2.0.0
 * 许可条款：LGPL-3.0
 * 所属作者：龙腾道 <LongTengDao@LongTengDao.com> (www.LongTengDao.com)
 * 问题反馈：https://GitHub.com/LongTengDao/j-thenable/issues
 * 项目主页：https://GitHub.com/LongTengDao/j-thenable/
 */
(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Thenable=e()})(this,function(){"use strict";var r=Object.freeze,c=void 0,a=Object.create||function(){var u;if(document.domain)try{e=new ActiveXObject("htmlfile")}catch(a){}if(e)e.write("<script><\/script>"),e.close(),u=e.parentWindow.Object.prototype;else{(e=document.createElement("iframe")).style.display="none";var t=document.body||document.documentElement;t.appendChild(e),e.src="javascript:",u=e.contentWindow.Object.prototype,t.removeChild(e)}var e=null;delete u.constructor,delete u.hasOwnProperty,delete u.isPrototypeOf,delete u.propertyIsEnumerable,delete u.toLocaleString,delete u.toString,delete u.valueOf;var o=function(){};o.prototype=u;var r=function(){};function n(t,e){if(e!==c)throw TypeError("CAN NOT defineProperties in ES 3 Object.create polyfill");if(null===t)return new o;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object prototype may only be an Object or null: "+t);r.prototype=t;var n=new r;return r.prototype=u,n}return function(t,e){return n(t,e)}}(),l=Object.assign,s=Object.prototype.hasOwnProperty,i="undefined"!=typeof Symbol?Symbol.toStringTag:undefined,f=Object.defineProperty,n=function n(t,e){return function(t,e){if(e||(e=t,t=a(null)),l)l(t,e);else{for(var n in e)s.call(e,n)&&(t[n]=e[n]);if(!{toString:null}.propertyIsEnumerable("toString"))for(var u=["constructor","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","valueOf","toLocaleString","toString"];n=u.pop();)s.call(e,n)&&(t[n]=e[n])}if(t["default"]=t,r){if(i){var o=a(null);o.value="Module",f(t,i,o)}r(t)}return t}(t,e)},_=0,v=1,p=2,o=function(){};function d(t){return t instanceof o}function y(t){return null!=t&&"function"==typeof t.then}function h(e,t){var n;t.then(function(t){n||(n=!0,j(e,t,v))},function(t){n||(n=!0,j(e,t,p))})}var b=null;function j(t,e,n){if(b)b={nextStack:b,thenable:t,value:e,status:n};else for(;;){t:{if(n===v){t._onrejected&&(t._onrejected=c);var u=t._onfulfilled;if(u){t._onfulfilled=c;try{if(d(e=u(e))){if((r=e._status)===_){e._on.push(t);break t}e=e._value,n=r}else if(y(e)){h(t,e);break t}}catch(s){if(t._status!==_)break t;e=s,n=p}}}else{t._onfulfilled&&(t._onfulfilled=c);var o=t._onrejected;if(o){t._onrejected=c;try{if(d(e=o(e))){var r;if((r=e._status)===_){e._on.push(t);break t}e=e._value,n=r}else{if(y(e)){h(t,e);break t}n=v}}catch(s){if(t._status!==_)break t;e=s}}}t._value=e,t._status=n;var a=t._on;if(a){t._on=null;for(var l=a.length;l;)b={nextStack:b,thenable:a[--l],value:e,status:n}}}if(!b)break;t=b.thenable,e=b.value,n=b.status,b=b.nextStack}}var t=function(t){if("function"!=typeof t)throw TypeError("Thenable executor is not a function");var n,u,o,r,a=this;try{if(t(function(t){if(!u)if(u=!0,n)try{d(t)?(r=t._status)===_?t._on.push(a):j(a,t._value,r):y(t)?h(a,t):j(a,t,v)}catch(e){a._status===_&&j(a,e,p)}else o=t,r=v},function(t){u||(u=!0,n?j(a,t,p):(o=t,r=p))}),!u)return n=!0,void(a._on=[])}catch(e){if(!u)return u=!0,a._value=e,void(a._status=p)}try{!function l(t,e,n){if(e===v){if(d(n))return void((e=n._status)===_?(t._on=[],n._on.push(t)):(t._value=n._value,t._status=e));if(y(n))return t._on=[],void h(t,n)}t._value=n,t._status=e}(a,r,o)}catch(e){a._status===_&&(a._value=e,a._status=p,a._on=null)}};function m(t,e){if(d(e)){var n=e._status;n===_?(t._on=[],e._on.push(t)):(t._value=e._value,t._status=n)}else y(e)?(t._on=[],h(t,e)):(t._value=e,t._status=v)}function w(t,e,n){try{m(n,e(t._value))}catch(u){n._status===_&&(n._value=u,n._status=p)}}return o.prototype=t.prototype={_status:_,_value:c,_on:null,_onfulfilled:c,_onrejected:c,then:function(t,e){var n=this,u=new o;switch(n._status){case _:return u._on=[],u._onfulfilled=t,u._onrejected=e,n._on.push(u),u;case v:return"function"==typeof t?w(n,t,u):(u._value=n._value,u._status=v),u;case p:return"function"==typeof e?w(n,e,u):(u._value=n._value,u._status=p),u}throw TypeError("Method Thenable.prototype.then called on incompatible receiver")}},n(t,{version:"2.0.0",Thenable:t,resolve:function u(t){var e=new o;try{m(e,t)}catch(n){e._status===_&&(e._value=n,e._status=p)}return e},reject:function O(t){var e=new o;return e._status=p,e._value=t,e},all:function k(t){var e=new o;try{!function f(t,u){function e(t){u._status===_&&j(u,t,p)}u._on=[];for(var o,r=[],a=0,n=t.length,l=0;l<n;++l){var s=t[l];if(d(s)){var i=s._status;if(i===_)++a,s._on.push({_status:0,_value:r[l]=c,_on:null,_onfulfilled:function(e){return function(t){u._status===_&&(r[e]=t,!--a&&o&&j(u,r,v))}}(l),_onrejected:e});else{if(i===p){u._value=s._value,u._status=p;break}r[l]=s._value}}else y(s)?(++a,r[l]=c,s.then(function(e){var n;return function(t){n||(n=!0,u._status===_&&(r[e]=t,!--a&&o&&j(u,r,v)))}}(l),e)):r[l]=s}o=!0,a||u._status!==_||(u._value=r,u._status=v,u._on=null)}(t,e)}catch(n){e._status===_&&(e._value=n,e._status=p,e._on=null)}return e},race:function S(t){var e=new o;try{!function i(t,e){function n(t){e._status===_&&j(e,t,v)}function u(t){e._status===_&&j(e,t,p)}e._on=[];for(var o={_status:0,_value:c,_on:null,_onfulfilled:n,_onrejected:u},r=t.length,a=0;a<r;++a){var l=t[a];if(d(l)){var s=l._status;if(s!==_){e._value=l._value,e._status=s;break}l._on.push(o)}else{if(!y(l)){e._value=l,e._status=v;break}if(l.then(n,u),e._status!==_)break}}}(t,e)}catch(n){e._status===_&&(e._value=n,e._status=p,e._on=null)}return e}})});
//# sourceMappingURL=j-thenable.min.js.map