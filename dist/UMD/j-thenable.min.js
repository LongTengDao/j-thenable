/*!
 * 模块名称：j-thenable
 * 模块功能：模仿 Promise API 的同步防爆栈工具。从属于“简计划”。
   　　　　　Sync stack anti-overflow util which's API is like Promise. Belong to "Plan J".
 * 模块版本：4.2.1
 * 许可条款：LGPL-3.0
 * 所属作者：龙腾道 <LongTengDao@LongTengDao.com> (www.LongTengDao.com)
 * 问题反馈：https://GitHub.com/LongTengDao/j-thenable/issues
 * 项目主页：https://GitHub.com/LongTengDao/j-thenable/
 */
(function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).Thenable=n()})(this,function(){"use strict";var c,s,d,a,l,i,p,h,y,v,b,w,k,f,_,j,m,O,g,t,u=Object.freeze,S=Object.seal,r="undefined"!=typeof Promise?Promise.prototype:undefined,o=Object.getPrototypeOf,n=Object.preventExtensions,E=void 0,T=0,M=1,W=2,x=function x(){c(this)};if("function"==typeof WeakMap){var P=new WeakMap,A=new WeakMap,C=new WeakMap,I=new WeakMap,L=new WeakMap,N=new WeakMap;c=n&&function(){var e=n({});return A.set(e,e),A.has(e)}()?function c(e){P.set(n(e),T)}:function c(e){P.set(e,T)},s=function s(e){return P.has(e)},d=function d(e){C["delete"](e)},i=function i(e){N["delete"](e)},p=l=function l(e){I["delete"](e)},h=a=function a(e){L["delete"](e)},y=function y(e){return P.get(e)},v=function v(e){return A.get(e)},b=function b(e){return C.get(e)},w=function w(e){return I.get(e)},k=function k(e){return L.get(e)},f=function f(e){return N.get(e)},_=function _(e,n){P.set(e,n)},j=function j(e,n){A.set(e,n)},m=function m(e,n){C.set(e,n)},O=function O(e,n){I.set(e,n)},g=function g(e,n){L.set(e,n)},t=function t(e,n){N.set(e,n)}}else c=function c(){},s=o?function(e){var n=x.prototype;return(s=function(e){return null!=e&&o(e)===n})(e)}:function s(e){return e instanceof x},d=function d(e){e._dependents=E},l=function l(e){e._onfulfilled=E},a=function a(e){e._onrejected=E},i=function i(e){e._onthen=E},p=function p(e){e._onfulfilled&&(e._onfulfilled=E)},h=function h(e){e._onrejected&&(e._onrejected=E)},y=function y(e){return e._status},v=function v(e){return e._value},b=function b(e){return e._dependents},w=function w(e){return e._onfulfilled},k=function k(e){return e._onrejected},f=function f(e){return e._onthen},_=function _(e,n){e._status=n},j=function j(e,n){e._value=n},m=function m(e,n){e._dependents=n},O=function O(e,n){e._onfulfilled=n},g=function g(e,n){e._onrejected=n},t=function t(e,n){e._onthen=n};var z=r?o?function z(e){return null!=e&&o(e)===r}:function(){function n(){}return n.prototype=r,function(e){return e instanceof n}}():function z(){return!1},X=null,q=!1;function B(e){var n=f(e);if(n)if(i(e),q)X={nextStack:X,thenable:e,onthen:n};else{for(q=!0;;){try{var t=n();if(s(t))if(n=f(t))i(t),b(t).push(e),X={nextStack:X,thenable:t,onthen:n};else{var r=y(t);r===T?b(t).push(e):G(e,v(t),r)}else z(t)?H(e,t):G(e,t,M)}catch(o){G(e,o,W)}if(!X)break;e=X.thenable,n=X.onthen,X=X.nextStack}q=!1}}var D=null,F=!1;function G(e,n,t){if(F)D={nextStack:D,thenable:e,value:n,status:t};else{F=!0;for(var r;;){e:{if(t===M){h(e);var o=w(e);if(o){l(e);try{if(n=o(n),s(n)){if(B(n),(r=y(n))===T){b(n).push(e);break e}n=v(n),t=r}else if(z(n)){H(e,n);break e}}catch(c){if(y(e)!==T)break e;n=c,t=W}}}else{p(e);var i=k(e);if(i){a(e);try{if(n=i(n),s(n)){if(B(n),(r=y(n))===T){b(n).push(e);break e}n=v(n),t=r}else{if(z(n)){H(e,n);break e}t=M}}catch(c){if(y(e)!==T)break e;n=c}}}j(e,n),_(e,t);var f=b(e);if(f){d(e);for(var u=f.length;u;)D={nextStack:D,thenable:f[--u],value:n,status:t}}}if(!D)break;e=D.thenable,n=D.value,t=D.status,D=D.nextStack}F=!1}}function H(n,e){var t;e.then(function(e){t||(t=!0,G(n,e,M))},function(e){t||(t=!0,G(n,e,W))})}var e=function(e){if(s(e))switch(B(e),y(e)){case M:return v(e);case W:throw v(e)}return e},J=function(e){if("function"!=typeof e)throw TypeError("new Thenable(executor is not a function)");var t,r,o,i,f=this;c(f);try{if(e(function(e){if(!r)if(r=!0,t)try{s(e)?(B(e),(i=y(e))===T?b(e).push(f):G(f,v(e),i)):z(e)?H(f,e):G(f,e,M)}catch(n){y(f)===T&&G(f,n,W)}else o=e,i=M},function(e){r||(r=!0,t?G(f,e,W):(o=e,i=W))}),!r)return t=!0,void m(f,[])}catch(n){if(!r)return r=!0,j(f,n),void _(f,W)}try{!function u(e,n,t){if(n===M){if(s(t))return B(t),void((n=y(t))===T?(m(e,[]),b(t).push(e)):(j(e,v(t)),_(e,n)));if(z(t))return m(e,[]),void H(e,t)}j(e,t),_(e,n)}(f,i,o)}catch(n){y(f)===T&&(j(f,n),_(f,W),d(f))}};var K="function"==typeof WeakMap?{then:Q}:{_status:T,_value:E,_dependents:E,_onfulfilled:E,_onrejected:E,_onthen:E,then:Q};function Q(e,n){var t=this;if(s(t)){B(t);var r=new x;switch(y(t)){case T:return m(r,[]),"function"==typeof e&&O(r,e),"function"==typeof n&&g(r,n),b(t).push(r),r;case M:return"function"==typeof e?R(t,e,r):(j(r,v(t)),_(r,M)),r;case W:return"function"==typeof n?R(t,n,r):(j(r,v(t)),_(r,W)),r}}throw TypeError("Method Thenable.prototype.then called on incompatible receiver")}function R(e,n,t){try{!function r(e,n){if(s(n)){B(n);var t=y(n);t===T?(m(e,[]),b(n).push(e)):(j(e,v(n)),_(e,t))}else z(n)?(m(e,[]),H(e,n)):(j(e,n),_(e,M))}(t,n(v(e)))}catch(o){y(t)===T&&(j(t,o),_(t,W))}}var U=Object.create||function(){var r;if(document.domain)try{n=new ActiveXObject("htmlfile")}catch(f){}if(n)n.write("<script><\/script>"),n.close(),r=n.parentWindow.Object.prototype;else{(n=document.createElement("iframe")).setAttribute("style","display:none !important;_display:none;");var e=document.body||document.documentElement;e.appendChild(n),n.src="javascript:",r=n.contentWindow.Object.prototype,e.removeChild(n)}var n=null;delete r.constructor,delete r.hasOwnProperty,delete r.isPrototypeOf,delete r.propertyIsEnumerable,delete r.toLocaleString,delete r.toString,delete r.valueOf;var o=function(){};o.prototype=r;var i=function(){};function t(e,n){if(n!==E)throw TypeError("CAN NOT defineProperties in ES 3 Object.create polyfill");if(null===e)return new o;if("object"!=typeof e&&"function"!=typeof e)throw TypeError("Object prototype may only be an Object or null: "+e);i.prototype=e;var t=new i;return i.prototype=r,t}return function(e,n){return t(e,n)}}(),V=Object.assign,Y=Object.prototype.hasOwnProperty,Z="undefined"!=typeof Symbol?Symbol.toStringTag:undefined,$=Object.defineProperty,ee=function ee(e,n){return function(e,n){if(n||(n=e,e=U(null)),V)V(e,n);else{for(var t in n)Y.call(n,t)&&(e[t]=n[t]);if(!{toString:null}.propertyIsEnumerable("toString"))for(var r=["constructor","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","valueOf","toLocaleString","toString"];t=r.pop();)Y.call(n,t)&&(e[t]=n[t])}if(e["default"]=e,S){if("function"==typeof e&&e.prototype&&S(e.prototype),Z){var o=U(null);o.value="Module",$(e,Z,o)}u(e)}return e}(e,n)};return J.prototype=x.prototype="function"==typeof WeakMap?u(K):S?S(K):K,ee(J,{version:"4.2.1",Thenable:J,resolve:function ne(e){if(s(e))return e;var n=new x;return z(e)?(m(n,[]),function r(e,n){try{H(e,n)}catch(t){y(e)===T&&(j(e,t),_(e,W))}}(n,e)):(j(n,e),_(n,M)),n},reject:function te(e){var n=new x;return _(n,W),j(n,e),n},all:function re(e){var n=new x;try{!function p(e,r){function o(e){y(r)===T&&G(r,e,W)}m(r,[]);for(var i,f=[],u=0,n=e.length,t=0;t<n;++t){var c=e[t];if(s(c)){B(c);var a=y(c);if(a===T){++u,f[t]=E;var l=new x;!function(n){O(l,function(e){y(r)===T&&(f[n]=e,!--u&&i&&G(r,f,M))})}(t),g(l,o),b(c).push(l)}else{if(a===W){j(r,v(c)),_(r,W);break}f[t]=v(c)}}else z(c)?(++u,f[t]=E,function(n){var t;c.then(function(e){t||(t=!0,y(r)===T&&(f[n]=e,!--u&&i&&G(r,f,M)))},o)}(t)):f[t]=c}i=!0,u||y(r)!==T||(j(r,f),_(r,M),d(r))}(e,n)}catch(t){y(n)===T&&(j(n,t),_(n,W),d(n))}return n},race:function oe(e){var n=new x;try{!function a(e,n){function t(e){y(n)===T&&G(n,e,M)}function r(e){y(n)===T&&G(n,e,W)}m(n,[]);var o=new x;O(o,t),g(o,r);for(var i=e.length,f=0;f<i;++f){var u=e[f];if(s(u)){B(u);var c=y(u);if(c!==T){j(n,v(u)),_(n,c);break}b(u).push(o)}else{if(!z(u)){j(n,u),_(n,M);break}if(u.then(t,r),y(n)!==T)break}}}(e,n)}catch(t){y(n)===T&&(j(n,t),_(n,W),d(n))}return n},pend:function ie(e){if("function"!=typeof e)throw TypeError("Thenable.pend(onthen is not a function)");var n=new x;return m(n,[]),t(n,e),n},await:e})});
//# sourceMappingURL=j-thenable.min.js.map