/*!
 * 模块名称：j-thenable
 * 模块功能：模仿 Promise API 的同步防爆栈工具。从属于“简计划”。
   　　　　　Sync stack anti-overflow util which's API is like Promise. Belong to "Plan J".
 * 模块版本：4.1.1
 * 许可条款：LGPL-3.0
 * 所属作者：龙腾道 <LongTengDao@LongTengDao.com> (www.LongTengDao.com)
 * 问题反馈：https://GitHub.com/LongTengDao/j-thenable/issues
 * 项目主页：https://GitHub.com/LongTengDao/j-thenable/
 */
(function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).Thenable=n()})(this,function(){"use strict";var c,p,s,a,l,i,d,h,y,v,b,_,w,u,k,j,m,o,f,t,O=Object.freeze,g=Object.seal,r="undefined"!=typeof Promise?Promise.prototype:undefined,S=Object.getPrototypeOf,T=void 0,E=0,M=1,W=2,P=function(){c(this)};if("function"==typeof WeakMap){var x=new WeakMap,A=new WeakMap,C=new WeakMap,I=new WeakMap,L=new WeakMap,N=new WeakMap;c=function c(e){x.set(e,E)},p=function p(e){return x.has(e)},s=function s(e){C["delete"](e)},l=function l(e){I["delete"](e)},a=function a(e){L["delete"](e)},i=function i(e){N["delete"](e)},d=function d(e){I["delete"](e)},h=function h(e){L["delete"](e)},y=function y(e){return x.get(e)},v=function v(e){return A.get(e)},b=function b(e){return C.get(e)},_=function _(e){return I.get(e)},w=function w(e){return L.get(e)},u=function u(e){return N.get(e)},k=function k(e,n){x.set(e,n)},j=function j(e,n){A.set(e,n)},m=function m(e,n){C.set(e,n)},o=function o(e,n){I.set(e,n)},f=function f(e,n){L.set(e,n)},t=function t(e,n){N.set(e,n)}}else c=function c(){},p=S?function(e){var n=P.prototype;return(p=function(e){return null!=e&&S(e)===n})(e)}:function p(e){return e instanceof P},s=function s(e){e._dependents=T},a=function a(e){e._onrejected=T},l=function l(e){e._onfulfilled=T},i=function i(e){e._onthen=T},d=function d(e){e._onfulfilled&&(e._onfulfilled=T)},h=function h(e){e._onrejected&&(e._onrejected=T)},y=function y(e){return e._status},v=function v(e){return e._value},b=function b(e){return e._dependents},_=function _(e){return e._onfulfilled},w=function w(e){return e._onrejected},u=function u(e){return e._onthen},k=function k(e,n){e._status=n},j=function j(e,n){e._value=n},m=function m(e,n){e._dependents=n},o=function o(e,n){e._onfulfilled=n},f=function f(e,n){e._onrejected=n},t=function t(e,n){e._onthen=n};var z=r?S?function z(e){return null!=e&&S(e)===r}:function(){function n(){}return n.prototype=r,function(e){return e instanceof n}}():function z(){return!1},X=null,q=!1;function B(e){var n=u(e);if(n)if(i(e),q)X={nextStack:X,thenable:e,onthen:n};else{for(q=!0;;){try{var t=n();if(p(t))if(n=u(t))i(t),b(t).push(e),X={nextStack:X,thenable:t,onthen:n};else{var r=y(t);r===E?b(t).push(e):G(e,v(t),r)}else z(t)?H(e,t):G(e,t,M)}catch(o){G(e,o,W)}if(!X)break;e=X.thenable,n=X.onthen,X=X.nextStack}q=!1}}var D=null,F=!1;function G(e,n,t){if(F)D={nextStack:D,thenable:e,value:n,status:t};else{F=!0;for(var r;;){e:{if(t===M){h(e);var o=_(e);if(o){l(e);try{if(n=o(n),p(n)){if(B(n),(r=y(n))===E){b(n).push(e);break e}n=v(n),t=r}else if(z(n)){H(e,n);break e}}catch(c){if(y(e)!==E)break e;n=c,t=W}}}else{d(e);var i=w(e);if(i){a(e);try{if(n=i(n),p(n)){if(B(n),(r=y(n))===E){b(n).push(e);break e}n=v(n),t=r}else{if(z(n)){H(e,n);break e}t=M}}catch(c){if(y(e)!==E)break e;n=c}}}j(e,n),k(e,t);var u=b(e);if(u){s(e);for(var f=u.length;f;)D={nextStack:D,thenable:u[--f],value:n,status:t}}}if(!D)break;e=D.thenable,n=D.value,t=D.status,D=D.nextStack}F=!1}}function H(n,e){var t;e.then(function(e){t||(t=!0,G(n,e,M))},function(e){t||(t=!0,G(n,e,W))})}var e=function(e){if(p(e))switch(B(e),y(e)){case M:return v(e);case W:throw v(e)}return e},n=function(e){if("function"!=typeof e)throw TypeError("new Thenable(executor is not a function)");var t,r,o,i,u=this;c(u);try{if(e(function(e){if(!r)if(r=!0,t)try{p(e)?(B(e),(i=y(e))===E?b(e).push(u):G(u,v(e),i)):z(e)?H(u,e):G(u,e,M)}catch(n){y(u)===E&&G(u,n,W)}else o=e,i=M},function(e){r||(r=!0,t?G(u,e,W):(o=e,i=W))}),!r)return t=!0,void m(u,[])}catch(n){if(!r)return r=!0,j(u,n),void k(u,W)}try{!function f(e,n,t){if(n===M){if(p(t))return B(t),void((n=y(t))===E?(m(e,[]),b(t).push(e)):(j(e,v(t)),k(e,n)));if(z(t))return m(e,[]),void H(e,t)}j(e,t),k(e,n)}(u,i,o)}catch(n){y(u)===E&&(j(u,n),k(u,W),s(u))}};var J="function"==typeof WeakMap?{then:K}:{_status:E,_value:T,_dependents:T,_onfulfilled:T,_onrejected:T,_onthen:T,then:K};function K(e,n){var t=this;if(p(t)){B(t);var r=new P;switch(y(t)){case E:return m(r,[]),"function"==typeof e&&o(r,e),"function"==typeof n&&f(r,n),b(t).push(r),r;case M:return"function"==typeof e?Q(t,e,r):(j(r,v(t)),k(r,M)),r;case W:return"function"==typeof n?Q(t,n,r):(j(r,v(t)),k(r,W)),r}}throw TypeError("Method Thenable.prototype.then called on incompatible receiver")}function Q(e,n,t){try{!function r(e,n){if(p(n)){B(n);var t=y(n);t===E?(m(e,[]),b(n).push(e)):(j(e,v(n)),k(e,t))}else z(n)?(m(e,[]),H(e,n)):(j(e,n),k(e,M))}(t,n(v(e)))}catch(o){y(t)===E&&(j(t,o),k(t,W))}}var R=Object.create||function(){var r;if(document.domain)try{n=new ActiveXObject("htmlfile")}catch(u){}if(n)n.write("<script><\/script>"),n.close(),r=n.parentWindow.Object.prototype;else{(n=document.createElement("iframe")).setAttribute("style","display:none !important;_display:none;");var e=document.body||document.documentElement;e.appendChild(n),n.src="javascript:",r=n.contentWindow.Object.prototype,e.removeChild(n)}var n=null;delete r.constructor,delete r.hasOwnProperty,delete r.isPrototypeOf,delete r.propertyIsEnumerable,delete r.toLocaleString,delete r.toString,delete r.valueOf;var o=function(){};o.prototype=r;var i=function(){};function t(e,n){if(n!==T)throw TypeError("CAN NOT defineProperties in ES 3 Object.create polyfill");if(null===e)return new o;if("object"!=typeof e&&"function"!=typeof e)throw TypeError("Object prototype may only be an Object or null: "+e);i.prototype=e;var t=new i;return i.prototype=r,t}return function(e,n){return t(e,n)}}(),U=Object.assign,V=Object.prototype.hasOwnProperty,Y="undefined"!=typeof Symbol?Symbol.toStringTag:undefined,Z=Object.defineProperty,$=function $(e,n){return function(e,n){if(n||(n=e,e=R(null)),U)U(e,n);else{for(var t in n)V.call(n,t)&&(e[t]=n[t]);if(!{toString:null}.propertyIsEnumerable("toString"))for(var r=["constructor","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","valueOf","toLocaleString","toString"];t=r.pop();)V.call(n,t)&&(e[t]=n[t])}if(e["default"]=e,g){if("function"==typeof e&&e.prototype&&g(e.prototype),Y){var o=R(null);o.value="Module",Z(e,Y,o)}O(e)}return e}(e,n)};return n.prototype=P.prototype="function"==typeof WeakMap?O(J):g?g(J):J,$(n,{version:"4.1.1",Thenable:n,resolve:function ee(e){if(p(e))return e;var n=new P;return z(e)?(m(n,[]),function r(e,n){try{H(e,n)}catch(t){y(e)===E&&(j(e,t),k(e,W))}}(n,e)):(j(n,e),k(n,M)),n},reject:function ne(e){var n=new P;return k(n,W),j(n,e),n},all:function te(e){var n=new P;try{!function l(e,r){function n(e){y(r)===E&&G(r,e,W)}m(r,[]);for(var o,i=[],u=0,t=e.length,f=0;f<t;++f){var c=e[f];if(p(c)){B(c);var a=y(c);if(a===E)++u,i[f]=T,b(c).push({_status:0,_value:T,_dependents:T,_onfulfilled:function(n){return function(e){y(r)===E&&(i[n]=e,!--u&&o&&G(r,i,M))}}(f),_onrejected:n});else{if(a===W){j(r,v(c)),k(r,W);break}i[f]=v(c)}}else z(c)?(++u,i[f]=T,c.then(function(n){var t;return function(e){t||(t=!0,y(r)===E&&(i[n]=e,!--u&&o&&G(r,i,M)))}}(f),n)):i[f]=c}o=!0,u||y(r)!==E||(j(r,i),k(r,M),s(r))}(e,n)}catch(t){y(n)===E&&(j(n,t),k(n,W),s(n))}return n},race:function re(e){var n=new P;try{!function a(e,n){function t(e){y(n)===E&&G(n,e,M)}function r(e){y(n)===E&&G(n,e,W)}m(n,[]);for(var o={_status:0,_value:T,_dependents:T,_onfulfilled:t,_onrejected:r},i=e.length,u=0;u<i;++u){var f=e[u];if(p(f)){B(f);var c=y(f);if(c!==E){j(n,v(f)),k(n,c);break}b(f).push(o)}else{if(!z(f)){j(n,f),k(n,M);break}if(f.then(t,r),y(n)!==E)break}}}(e,n)}catch(t){y(n)===E&&(j(n,t),k(n,W),s(n))}return n},pend:function oe(e){if("function"!=typeof e)throw TypeError("Thenable.pend(onthen is not a function)");var n=new P;return m(n,[]),t(n,e),n},await:e})});
//# sourceMappingURL=j-thenable.min.js.map