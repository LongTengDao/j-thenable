/*!
 * 模块名称：j-thenable
 * 模块功能：模仿 Promise API 的同步防爆栈工具。从属于“简计划”。
   　　　　　Sync stack anti-overflow util which's API is like Promise. Belong to "Plan J".
 * 模块版本：4.0.0
 * 许可条款：LGPL-3.0
 * 所属作者：龙腾道 <LongTengDao@LongTengDao.com> (www.LongTengDao.com)
 * 问题反馈：https://GitHub.com/LongTengDao/j-thenable/issues
 * 项目主页：https://GitHub.com/LongTengDao/j-thenable/
 */
(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Thenable=t()})(this,function(){"use strict";var a=Object.seal,o=Object.freeze,_=void 0,d=0,p=1,v=2,y=1,h=2,s=function(){};function t(e){return e instanceof s}var n,b="function"==typeof Promise?((n=function(){}).prototype=Promise.prototype,function(e){return t(e)?y:e instanceof n?h:0}):function b(e){return t(e)?y:0},f=null;function j(e,t,n){if(f)f={nextStack:f,thenable:e,value:t,status:n};else for(var u,r;;){e:{if(n===p){e._onrejected&&(e._onrejected=_);var a=e._onfulfilled;if(a){e._onfulfilled=_;try{if((u=b(t=a(t)))===y){if((r=t._status)===d){t._dependents.push(e);break e}t=t._value,n=r}else if(u===h){c(e,t);break e}}catch(i){if(e._status!==d)break e;t=i,n=v}}}else{e._onfulfilled&&(e._onfulfilled=_);var o=e._onrejected;if(o){e._onrejected=_;try{if((u=b(t=o(t)))===y){if((r=t._status)===d){t._dependents.push(e);break e}t=t._value,n=r}else{if(u===h){c(e,t);break e}n=p}}catch(i){if(e._status!==d)break e;t=i}}}e._value=t,e._status=n;var s=e._dependents;if(s){e._dependents=null;for(var l=s.length;l;)f={nextStack:f,thenable:s[--l],value:t,status:n}}}if(!f)break;e=f.thenable,t=f.value,n=f.status,f=f.nextStack}}function c(t,e){var n;e.then(function(e){n||(n=!0,j(t,e,p))},function(e){n||(n=!0,j(t,e,v))})}var e=function(e){if(t(e))switch(e._status){case p:return e._value;case v:throw e._value}return e},u=function(e){if("function"!=typeof e)throw TypeError("Thenable executor is not a function");var u,r,a,o,s=this;try{if(e(function(e){if(!r)if(r=!0,u)try{var t=b(e);t===y?(o=e._status)===d?e._dependents.push(s):j(s,e._value,o):t===h?c(s,e):j(s,e,p)}catch(n){s._status===d&&j(s,n,v)}else a=e,o=p},function(e){r||(r=!0,u?j(s,e,v):(a=e,o=v))}),!r)return u=!0,void(s._dependents=[])}catch(t){if(!r)return r=!0,s._value=t,void(s._status=v)}try{!function l(e,t,n){if(t===p){var u=b(n);if(u===y)return void((t=n._status)===d?(e._dependents=[],n._dependents.push(e)):(e._value=n._value,e._status=t));if(u===h)return e._dependents=[],void c(e,n)}e._value=n,e._status=t}(s,o,a)}catch(t){s._status===d&&(s._value=t,s._status=v,s._dependents=null)}};var r={_status:d,_value:_,_dependents:null,_onfulfilled:_,_onrejected:_,_Value:_,then:function(e,t){var n=this,u=n._Value;u&&(n._Value=_,function a(e,t){try{j(t,e(),p)}catch(n){j(t,n,v)}}(u,n));var r=new s;switch(n._status){case d:return r._dependents=[],r._onfulfilled=e,r._onrejected=t,n._dependents.push(r),r;case p:return"function"==typeof e?l(n,e,r):(r._value=n._value,r._status=p),r;case v:return"function"==typeof t?l(n,t,r):(r._value=n._value,r._status=v),r}throw TypeError("Method Thenable.prototype.then called on incompatible receiver")}};function l(e,t,n){try{!function u(e,t){if(b(t)===y){var n=t._status;n===d?(e._dependents=[],t._dependents.push(e)):(e._value=t._value,e._status=n)}else t===h?(e._dependents=[],c(e,t)):(e._value=t,e._status=p)}(n,t(e._value))}catch(r){n._status===d&&(n._value=r,n._status=v)}}var i=Object.create||function(){var u;if(document.domain)try{t=new ActiveXObject("htmlfile")}catch(o){}if(t)t.write("<script><\/script>"),t.close(),u=t.parentWindow.Object.prototype;else{(t=document.createElement("iframe")).style.display="none";var e=document.body||document.documentElement;e.appendChild(t),t.src="javascript:",u=t.contentWindow.Object.prototype,e.removeChild(t)}var t=null;delete u.constructor,delete u.hasOwnProperty,delete u.isPrototypeOf,delete u.propertyIsEnumerable,delete u.toLocaleString,delete u.toString,delete u.valueOf;var r=function(){};r.prototype=u;var a=function(){};function n(e,t){if(t!==_)throw TypeError("CAN NOT defineProperties in ES 3 Object.create polyfill");if(null===e)return new r;if("object"!=typeof e&&"function"!=typeof e)throw TypeError("Object prototype may only be an Object or null: "+e);a.prototype=e;var n=new a;return a.prototype=u,n}return function(e,t){return n(e,t)}}(),m=Object.assign,w=Object.prototype.hasOwnProperty,O="undefined"!=typeof Symbol?Symbol.toStringTag:undefined,k=Object.defineProperty,S=function S(e,t){return function(e,t){if(t||(t=e,e=i(null)),m)m(e,t);else{for(var n in t)w.call(t,n)&&(e[n]=t[n]);if(!{toString:null}.propertyIsEnumerable("toString"))for(var u=["constructor","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","valueOf","toLocaleString","toString"];n=u.pop();)w.call(t,n)&&(e[n]=t[n])}if(e["default"]=e,a){if("function"==typeof e&&e.prototype&&a(e.prototype),O){var r=i(null);r.value="Module",k(e,O,r)}o(e)}return e}(e,t)};return u.prototype=s.prototype=a?a(r):r,S(u,{version:"4.0.0",Thenable:u,resolve:function g(e){var t=b(e);if(t===y)return e;var n=new s;return t===h?(n._dependents=[],function u(e,t){try{c(e,t)}catch(n){e._status===d&&(e._value=n,e._status=v)}}(n,e)):(n._value=e,n._status=p),n},reject:function E(e){var t=new s;return t._status=v,t._value=e,t},all:function T(e){var t=new s;try{!function c(e,u){function t(e){u._status===d&&j(u,e,v)}u._dependents=[];for(var r,a=[],o=0,n=e.length,s=0;s<n;++s){var l=e[s],i=b(l);if(i===y){var f=l._status;if(f===d)++o,l._dependents.push({_status:0,_value:a[s]=_,_dependents:null,_onfulfilled:function(t){return function(e){u._status===d&&(a[t]=e,!--o&&r&&j(u,a,p))}}(s),_onrejected:t});else{if(f===v){u._value=l._value,u._status=v;break}a[s]=l._value}}else i===h?(++o,a[s]=_,l.then(function(t){var n;return function(e){n||(n=!0,u._status===d&&(a[t]=e,!--o&&r&&j(u,a,p)))}}(s),t)):a[s]=l}r=!0,o||u._status!==d||(u._value=a,u._status=p,u._dependents=null)}(e,t)}catch(n){t._status===d&&(t._value=n,t._status=v,t._dependents=null)}return t},race:function P(e){var t=new s;try{!function f(e,t){function n(e){t._status===d&&j(t,e,p)}function u(e){t._status===d&&j(t,e,v)}t._dependents=[];for(var r={_status:0,_value:_,_dependents:null,_onfulfilled:n,_onrejected:u},a=e.length,o=0;o<a;++o){var s=e[o],l=b(s);if(l===y){var i=s._status;if(i!==d){t._value=s._value,t._status=i;break}s._dependents.push(r)}else{if(l!==h){t._value=s,t._status=p;break}if(s.then(n,u),t._status!==d)break}}}(e,t)}catch(n){t._status===d&&(t._value=n,t._status=v,t._dependents=null)}return t},pend:function x(e){var t=new s;return t._dependents=[],t._Value=e,t},await:e})});
//# sourceMappingURL=j-thenable.min.js.map