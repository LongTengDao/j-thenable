/*!
 * 模块名称：j-thenable
 * 模块功能：模仿 Promise API 的同步防爆栈工具。从属于“简计划”。
   　　　　　Sync stack anti-overflow util which's API is like Promise. Belong to "Plan J".
 * 模块版本：1.0.1
 * 许可条款：LGPL-3.0
 * 所属作者：龙腾道 <LongTengDao@LongTengDao.com> (www.LongTengDao.com)
 * 问题反馈：https://GitHub.com/LongTengDao/j-thenable/issues
 * 项目主页：https://GitHub.com/LongTengDao/j-thenable/
 */
(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Thenable=t()})(this,function(){"use strict";var u=Object.freeze,f=void 0,a=Object.create||function(){var r;if(document.domain)try{t=new ActiveXObject("htmlfile")}catch(a){}if(t)t.write("<script><\/script>"),t.close(),r=t.parentWindow.Object.prototype;else{(t=document.createElement("iframe")).style.display="none";var e=document.body||document.documentElement;e.appendChild(t),t.src="javascript:",r=t.contentWindow.Object.prototype,e.removeChild(t)}var t=null;delete r.constructor,delete r.hasOwnProperty,delete r.isPrototypeOf,delete r.propertyIsEnumerable,delete r.toLocaleString,delete r.toString,delete r.valueOf;var o=function(){};o.prototype=r;var u=function(){};function n(e,t){if(t!==f)throw TypeError("CAN NOT defineProperties in ES 3 Object.create polyfill");if(null===e)return new o;if("object"!=typeof e&&"function"!=typeof e)throw TypeError("Object prototype may only be an Object or null: "+e);u.prototype=e;var n=new u;return u.prototype=r,n}return function(e,t){return n(e,t)}}(),l=Object.assign,i=Object.prototype.hasOwnProperty,s="undefined"!=typeof Symbol?Symbol.toStringTag:undefined,c=Object.defineProperty,n=function n(e,t){return function(e,t){if(t||(t=e,e=a(null)),l)l(e,t);else{for(var n in t)i.call(t,n)&&(e[n]=t[n]);if(!{toString:null}.propertyIsEnumerable("toString"))for(var r=["constructor","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","valueOf","toLocaleString","toString"];n=r.pop();)i.call(t,n)&&(e[n]=t[n])}if(e["default"]=e,u){if(s){var o=a(null);o.value="Module",c(e,s,o)}u(e)}return e}(e,t)},_=0,v=1,p=2,d=function(){};function y(e){return e instanceof d}function h(e,t){if(y(t)){var n=t._status;n===_?(e._on=[],t._on.push(e)):(e._value=t._value,e._status=n)}else e._value=t,e._status=v}var b=null;function j(e,t,n){if(b)b={nextStack:b,thenable:e,value:t,status:n};else for(;;){e:{if(n===v){e._onrejected&&(e._onrejected=f);var r=e._onfulfilled;if(r){e._onfulfilled=f;try{if(y(t=r(t))){if((u=t._status)===_){t._on.push(e);break e}t=t._value,n=u}}catch(i){t=i,n=p}}}else{e._onfulfilled&&(e._onfulfilled=f);var o=e._onrejected;if(o){e._onrejected=f;try{if(y(t=o(t))){var u;if((u=t._status)===_){t._on.push(e);break e}t=t._value,n=u}else n=v}catch(i){t=i}}}e._value=t,e._status=n;var a=e._on;if(a){e._on=null;for(var l=a.length;l;)b={nextStack:b,thenable:a[--l],value:t,status:n}}}if(!b)break;e=b.thenable,t=b.value,n=b.status,b=b.nextStack}}var e=function(e){if("function"!=typeof e)throw TypeError("Thenable executor is not a function");var t,n,r,o,u=this;u._on=[];try{if(e(function(e){n||(n=!0,t?y(e)?(o=e._status)===_?e._on.push(u):j(u,e._value,o):j(u,e,v):(r=e,o=v))},function(e){n||(n=!0,t?j(u,e,p):(r=e,o=p))}),!n)return void(t=!0)}catch(a){if(!n)return n=!0,u._value=a,u._status=p,void(u._on=null)}if(o===v&&y(r)){if((o=r._status)===_)return void r._on.push(u);r=r._value}u._value=r,u._status=o,u._on=null};return d.prototype=e.prototype={_status:_,_value:f,_on:null,_onfulfilled:f,_onrejected:f,then:function(e,t){var n=this,r=new d;switch(n._status){case _:return r._on=[],r._onfulfilled=e,r._onrejected=t,n._on.push(r),r;case v:if("function"==typeof e)try{h(r,e(n._value))}catch(o){r._value=o,r._status=p}else r._value=n._value,r._status=v;return r;case p:if("function"==typeof t)try{h(r,t(n._value))}catch(o){r._value=o,r._status=p}else r._value=n._value,r._status=p;return r}throw TypeError("Method Thenable.prototype.then called on incompatible receiver")}},n(e,{version:"1.0.1",Thenable:e,isThenable:y,resolve:function r(e){var t=new d;return h(t,e),t},reject:function o(e){var t=new d;return t._status=p,t._value=e,t},all:function m(e){var n=new d;n._on=[];var r=[],o=0;function t(e){n._status===_&&j(n,e,p)}for(var u=e.length,a=0;a<u;++a){var l=e[a];if(y(l)){var i=l._status;if(i===_)++o,r[a]=f,l._on.push({_onfulfilled:function(t){return function(e){n._status===_&&(r[t]=e,1<o?--o:j(n,r,v))}}(a),_onrejected:t});else{if(i===p){n._value=l._value,n._status=p;break}r[a]=l._value}}else r[a]=l}return n},race:function w(e){var t=new d;t._on=[];for(var n={_onfulfilled:function(e){t._status===_&&j(t,e,v)},_onrejected:function(e){t._status===_&&j(t,e,p)}},r=e.length,o=0;o<r;++o){var u=e[o];if(!y(u)){t._value=u,t._status=v;break}var a=u._status;if(a!==_){t._value=u._value,t._status=a;break}u._on.push(n)}return t}})});
//# sourceMappingURL=j-thenable.min.js.map