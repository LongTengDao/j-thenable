/*!
 * 模块名称：j-thenable
 * 模块功能：模仿 Promise API 的同步防爆栈工具。从属于“简计划”。
   　　　　　Sync stack anti-overflow util which's API is like Promise. Belong to "Plan J".
 * 模块版本：4.0.1
 * 许可条款：LGPL-3.0
 * 所属作者：龙腾道 <LongTengDao@LongTengDao.com> (www.LongTengDao.com)
 * 问题反馈：https://GitHub.com/LongTengDao/j-thenable/issues
 * 项目主页：https://GitHub.com/LongTengDao/j-thenable/
 */
(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Thenable=t()})(this,function(){"use strict";var r=Object.seal,s=Object.freeze,e="undefined"!=typeof Promise?Promise.prototype:undefined,c=void 0,_=0,d=1,p=2,a=function(){},t=!1;function n(e){return e instanceof a}var u,v=e?((u=function(){}).prototype=e,function(e){return e instanceof a||(t=e instanceof u,!1)}):n;function y(e){return t}var o=null,l=!1;function h(e){var t=e._Value;if(t)if(e._Value=c,l)o={nextStack:o,thenable:e,Value:t};else{for(l=!0;;){try{var n=t();if(v(n))if(t=n._Value)n._Value=c,n._dependents.push(e),o={nextStack:o,thenable:n,Value:t};else{var u=n._status;u===_?n._dependents.push(e):b(e,n._value,u)}else y()?j(e,n):b(e,n,d)}catch(a){b(e,a,p)}if(!o)break;e=o.thenable,t=o.Value,o=o.nextStack}l=!1}}var i=null,f=!1;function b(e,t,n){if(f)i={nextStack:i,thenable:e,value:t,status:n};else{f=!0;for(var u;;){e:{if(n===d){e._onrejected&&(e._onrejected=c);var a=e._onfulfilled;if(a){e._onfulfilled=c;try{if(t=a(t),v(t)){if(h(t),(u=t._status)===_){t._dependents.push(e);break e}t=t._value,n=u}else if(y()){j(e,t);break e}}catch(l){if(e._status!==_)break e;t=l,n=p}}}else{e._onfulfilled&&(e._onfulfilled=c);var r=e._onrejected;if(r){e._onrejected=c;try{if(t=r(t),v(t)){if(h(t),(u=t._status)===_){t._dependents.push(e);break e}t=t._value,n=u}else{if(y()){j(e,t);break e}n=d}}catch(l){if(e._status!==_)break e;t=l}}}e._value=t,e._status=n;var s=e._dependents;if(s){e._dependents=null;for(var o=s.length;o;)i={nextStack:i,thenable:s[--o],value:t,status:n}}}if(!i)break;e=i.thenable,t=i.value,n=i.status,i=i.nextStack}f=!1}}function j(t,e){var n;e.then(function(e){n||(n=!0,b(t,e,d))},function(e){n||(n=!0,b(t,e,p))})}var m=function(e){if(n(e))switch(h(e),e._status){case d:return e._value;case p:throw e._value}return e},w=function(e){if("function"!=typeof e)throw TypeError("Thenable executor is not a function");var n,u,a,r,s=this;try{if(e(function(e){if(!u)if(u=!0,n)try{v(e)?(h(e),(r=e._status)===_?e._dependents.push(s):b(s,e._value,r)):y()?j(s,e):b(s,e,d)}catch(t){s._status===_&&b(s,t,p)}else a=e,r=d},function(e){u||(u=!0,n?b(s,e,p):(a=e,r=p))}),!u)return n=!0,void(s._dependents=[])}catch(t){if(!u)return u=!0,s._value=t,void(s._status=p)}try{!function o(e,t,n){if(t===d){if(v(n))return h(n),void((t=n._status)===_?(e._dependents=[],n._dependents.push(e)):(e._value=n._value,e._status=t));if(y())return e._dependents=[],void j(e,n)}e._value=n,e._status=t}(s,r,a)}catch(t){s._status===_&&(s._value=t,s._status=p,s._dependents=null)}};var O={_status:_,_value:c,_dependents:null,_onfulfilled:c,_onrejected:c,_Value:c,then:function(e,t){var n=this;h(n);var u=new a;switch(n._status){case _:return u._dependents=[],u._onfulfilled=e,u._onrejected=t,n._dependents.push(u),u;case d:return"function"==typeof e?k(n,e,u):(u._value=n._value,u._status=d),u;case p:return"function"==typeof t?k(n,t,u):(u._value=n._value,u._status=p),u}throw TypeError("Method Thenable.prototype.then called on incompatible receiver")}};function k(e,t,n){try{!function u(e,t){if(v(t)){h(t);var n=t._status;n===_?(e._dependents=[],t._dependents.push(e)):(e._value=t._value,e._status=n)}else y()?(e._dependents=[],j(e,t)):(e._value=t,e._status=d)}(n,t(e._value))}catch(a){n._status===_&&(n._value=a,n._status=p)}}var S=Object.create||function(){var u;if(document.domain)try{t=new ActiveXObject("htmlfile")}catch(s){}if(t)t.write("<script><\/script>"),t.close(),u=t.parentWindow.Object.prototype;else{(t=document.createElement("iframe")).style.display="none";var e=document.body||document.documentElement;e.appendChild(t),t.src="javascript:",u=t.contentWindow.Object.prototype,e.removeChild(t)}var t=null;delete u.constructor,delete u.hasOwnProperty,delete u.isPrototypeOf,delete u.propertyIsEnumerable,delete u.toLocaleString,delete u.toString,delete u.valueOf;var a=function(){};a.prototype=u;var r=function(){};function n(e,t){if(t!==c)throw TypeError("CAN NOT defineProperties in ES 3 Object.create polyfill");if(null===e)return new a;if("object"!=typeof e&&"function"!=typeof e)throw TypeError("Object prototype may only be an Object or null: "+e);r.prototype=e;var n=new r;return r.prototype=u,n}return function(e,t){return n(e,t)}}(),g=Object.assign,E=Object.prototype.hasOwnProperty,T="undefined"!=typeof Symbol?Symbol.toStringTag:undefined,x=Object.defineProperty,P=function P(e,t){return function(e,t){if(t||(t=e,e=S(null)),g)g(e,t);else{for(var n in t)E.call(t,n)&&(e[n]=t[n]);if(!{toString:null}.propertyIsEnumerable("toString"))for(var u=["constructor","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","valueOf","toLocaleString","toString"];n=u.pop();)E.call(t,n)&&(e[n]=t[n])}if(e["default"]=e,r){if("function"==typeof e&&e.prototype&&r(e.prototype),T){var a=S(null);a.value="Module",x(e,T,a)}s(e)}return e}(e,t)};return w.prototype=a.prototype=r?r(O):O,P(w,{version:"4.0.1",Thenable:w,resolve:function V(e){if(v(e))return e;var t=new a;return y()?(t._dependents=[],function u(e,t){try{j(e,t)}catch(n){e._status===_&&(e._value=n,e._status=p)}}(t,e)):(t._value=e,t._status=d),t},reject:function C(e){var t=new a;return t._status=p,t._value=e,t},all:function I(e){var t=new a;try{!function f(e,u){function t(e){u._status===_&&b(u,e,p)}u._dependents=[];for(var a,r=[],s=0,n=e.length,o=0;o<n;++o){var l=e[o];if(v(l)){h(l);var i=l._status;if(i===_)++s,l._dependents.push({_status:0,_value:r[o]=c,_dependents:null,_onfulfilled:function(t){return function(e){u._status===_&&(r[t]=e,!--s&&a&&b(u,r,d))}}(o),_onrejected:t});else{if(i===p){u._value=l._value,u._status=p;break}r[o]=l._value}}else y()?(++s,r[o]=c,l.then(function(t){var n;return function(e){n||(n=!0,u._status===_&&(r[t]=e,!--s&&a&&b(u,r,d)))}}(o),t)):r[o]=l}a=!0,s||u._status!==_||(u._value=r,u._status=d,u._dependents=null)}(e,t)}catch(n){t._status===_&&(t._value=n,t._status=p,t._dependents=null)}return t},race:function A(e){var t=new a;try{!function i(e,t){function n(e){t._status===_&&b(t,e,d)}function u(e){t._status===_&&b(t,e,p)}t._dependents=[];for(var a={_status:0,_value:c,_dependents:null,_onfulfilled:n,_onrejected:u},r=e.length,s=0;s<r;++s){var o=e[s];if(v(o)){h(o);var l=o._status;if(l!==_){t._value=o._value,t._status=l;break}o._dependents.push(a)}else{if(!y()){t._value=o,t._status=d;break}if(o.then(n,u),t._status!==_)break}}}(e,t)}catch(n){t._status===_&&(t._value=n,t._status=p,t._dependents=null)}return t},pend:function L(e){var t=new a;return t._dependents=[],t._Value=e,t},await:m})});
//# sourceMappingURL=j-thenable.min.js.map