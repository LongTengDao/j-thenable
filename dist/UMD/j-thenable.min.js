/*!
 * 模块名称：j-thenable
 * 模块功能：模仿 Promise API 的同步防爆栈工具。从属于“简计划”。
   　　　　　Sync stack anti-overflow util which's API is like Promise. Belong to "Plan J".
 * 模块版本：1.0.3
 * 许可条款：LGPL-3.0
 * 所属作者：龙腾道 <LongTengDao@LongTengDao.com> (www.LongTengDao.com)
 * 问题反馈：https://GitHub.com/LongTengDao/j-thenable/issues
 * 项目主页：https://GitHub.com/LongTengDao/j-thenable/
 */
(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Thenable=e()})(this,function(){"use strict";var a=Object.freeze,_=void 0,o=Object.create||function(){var u;if(document.domain)try{e=new ActiveXObject("htmlfile")}catch(o){}if(e)e.write("<script><\/script>"),e.close(),u=e.parentWindow.Object.prototype;else{(e=document.createElement("iframe")).style.display="none";var t=document.body||document.documentElement;t.appendChild(e),e.src="javascript:",u=e.contentWindow.Object.prototype,t.removeChild(e)}var e=null;delete u.constructor,delete u.hasOwnProperty,delete u.isPrototypeOf,delete u.propertyIsEnumerable,delete u.toLocaleString,delete u.toString,delete u.valueOf;var r=function(){};r.prototype=u;var a=function(){};function n(t,e){if(e!==_)throw TypeError("CAN NOT defineProperties in ES 3 Object.create polyfill");if(null===t)return new r;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object prototype may only be an Object or null: "+t);a.prototype=t;var n=new a;return a.prototype=u,n}return function(t,e){return n(t,e)}}(),l=Object.assign,s=Object.prototype.hasOwnProperty,i="undefined"!=typeof Symbol?Symbol.toStringTag:undefined,f=Object.defineProperty,n=function n(t,e){return function(t,e){if(e||(e=t,t=o(null)),l)l(t,e);else{for(var n in e)s.call(e,n)&&(t[n]=e[n]);if(!{toString:null}.propertyIsEnumerable("toString"))for(var u=["constructor","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","valueOf","toLocaleString","toString"];n=u.pop();)s.call(e,n)&&(t[n]=e[n])}if(t["default"]=t,a){if(i){var r=o(null);r.value="Module",f(t,i,r)}a(t)}return t}(t,e)},c=0,v=1,p=2,d=function(){};function y(t){return t instanceof d}function h(t){return null!=t&&"function"==typeof t.then}function b(e,t){var n;t.then(function(t){n||(n=!0,m(e,t,v))},function(t){n||(n=!0,m(e,t,p))})}var j=null;function m(t,e,n){if(j)j={nextStack:j,thenable:t,value:e,status:n};else for(;;){t:{if(n===v){t._onrejected&&(t._onrejected=_);var u=t._onfulfilled;if(u){t._onfulfilled=_;try{if(y(e=u(e))){if((a=e._status)===c){e._on.push(t);break t}e=e._value,n=a}else if(h(e)){b(t,e);break t}}catch(s){if(t._status!==c)break t;e=s,n=p}}}else{t._onfulfilled&&(t._onfulfilled=_);var r=t._onrejected;if(r){t._onrejected=_;try{if(y(e=r(e))){var a;if((a=e._status)===c){e._on.push(t);break t}e=e._value,n=a}else{if(h(e)){b(t,e);break t}n=v}}catch(s){if(t._status!==c)break t;e=s}}}t._value=e,t._status=n;var o=t._on;if(o){t._on=null;for(var l=o.length;l;)j={nextStack:j,thenable:o[--l],value:e,status:n}}}if(!j)break;t=j.thenable,e=j.value,n=j.status,j=j.nextStack}}var t=function(t){if("function"!=typeof t)throw TypeError("Thenable executor is not a function");var n,u,r,a,o=this;try{if(t(function(t){if(!u)if(u=!0,n)try{y(t)?(a=t._status)===c?t._on.push(o):m(o,t._value,a):h(t)?b(o,t):m(o,t,v)}catch(e){o._status===c&&m(o,e,p)}else r=t,a=v},function(t){u||(u=!0,n?m(o,t,p):(r=t,a=p))}),!u)return n=!0,void(o._on=[])}catch(e){if(!u)return u=!0,o._value=e,void(o._status=p)}try{a===v&&y(r)?(a=r._status)===c?(o._on=[],r._on.push(o)):(o._value=r._value,o._status=a):a===v&&h(r)?(o._on=[],b(o,r)):(o._value=r,o._status=a)}catch(e){o._status===c&&(o._value=e,o._status=p,o._on=null)}};function w(t,e){if(y(e)){var n=e._status;n===c?(t._on=[],e._on.push(t)):(t._value=e._value,t._status=n)}else h(e)?(t._on=[],b(t,e)):(t._value=e,t._status=v)}return d.prototype=t.prototype={_status:c,_value:_,_on:null,_onfulfilled:_,_onrejected:_,then:function(t,e){var n=this,u=new d;switch(n._status){case c:return u._on=[],u._onfulfilled=t,u._onrejected=e,n._on.push(u),u;case v:if("function"==typeof t)try{w(u,t(n._value))}catch(r){u._status===c&&(u._value=r,u._status=p)}else u._value=n._value,u._status=v;return u;case p:if("function"==typeof e)try{w(u,e(n._value))}catch(r){u._status===c&&(u._value=r,u._status=p)}else u._value=n._value,u._status=p;return u}throw TypeError("Method Thenable.prototype.then called on incompatible receiver")}},n(t,{version:"1.0.3",Thenable:t,resolve:function u(t){var e=new d;try{w(e,t)}catch(n){e._status===c&&(e._value=n,e._status=p)}return e},reject:function r(t){var e=new d;return e._status=p,e._value=t,e},all:function O(t){var u=new d;u._on=[];var r,a=[],o=0;function e(t){u._status===c&&m(u,t,p)}try{for(var n=t.length,l=0;l<n;++l){var s=t[l];if(y(s)){var i=s._status;if(i===c)++o,s._on.push({_status:0,_value:a[l]=_,_on:null,_onfulfilled:function(e){return function(t){u._status===c&&(a[e]=t,!--o&&r&&m(u,a,v))}}(l),_onrejected:e});else{if(i===p){u._value=s._value,u._status=p;break}a[l]=s._value}}else h(s)?(++o,a[l]=_,s.then(function(e){var n;return function(t){n||(n=!0,u._status===c&&(a[e]=t,!--o&&r&&m(u,a,v)))}}(l),e)):a[l]=s}r=!0,o||u._status!==c||(u._value=a,u._status=v,u._on=null)}catch(f){u._status===c&&(u._value=f,u._status=p,u._on=null)}return u},race:function k(t){var e=new d;function n(t){e._status===c&&m(e,t,v)}function u(t){e._status===c&&m(e,t,p)}e._on=[];var r={_status:0,_value:_,_on:null,_onfulfilled:n,_onrejected:u};try{for(var a=t.length,o=0;o<a;++o){var l=t[o];if(y(l)){var s=l._status;if(s!==c){e._value=l._value,e._status=s;break}l._on.push(r)}else{if(!h(l)){e._value=l,e._status=v;break}if(l.then(n,u),e._status!==c)break}}}catch(i){e._status===c&&(e._value=i,e._status=p,e._on=null)}return e}})});
//# sourceMappingURL=j-thenable.min.js.map